{% extends 'basic.html'%}

{% block head %}
    <script src="static/css/jquery-3.5.1.min.js"></script>
    <script src="static/css/echarts.min.js"></script>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <style>
    .bd-placeholder-img {
        font-size: 1.125rem;
        text-anchor: middle;
      }
    @media (min-width: 768px) {
        .bd-placeholder-img-lg {
          font-size: 3.5rem;
        }
      }
    .slidecontainer {
      width: 100%;
    }

    .slider {
      -webkit-appearance: none;
      width: 70%;
      height: 50px;
      background: #d3d3d3;
      outline: none;
      opacity: 0.7;
      -webkit-transition: .2s;
      transition: opacity .2s;
    }

    .slider:hover {
      opacity: 1;
    }

    .slider::-webkit-slider-thumb {
      -webkit-appearance: none;
      appearance: none;
      width: 50px;
      height: 50px;
      background: #04AA6D;
      cursor: pointer;
    }

    .slider::-moz-range-thumb {
      width: 50px;
      height: 50px;
      background: #04AA6D;
      cursor: pointer;
    }
</style>
    <script type="text/javascript">
        var csrftoken = "{{ csrf_token() }}"
        $.ajaxSetup({
            beforeSend: function(xhr, settings) {
                if (!/^(GET|HEAD|OPTIONS|TRACE)$/i.test(settings.type) && !this.crossDomain) {
                    xhr.setRequestHeader("X-CSRFToken", csrftoken)
                }
             }
        })
      $(document).ready(function() {

                var currentpage=1;
                var ID;
                var filedirname;
                var contour;
                var threshold = 0.5;
                var ID_probaility_resnet ;
                var red_yellow_resnet;
                var ID_probaility_densenet ;
                var red_yellow_densenet;


                var slider = document.getElementById("myRange");
                var output = document.getElementById("demo");
                output.innerHTML = parseFloat(slider.value)/100;
                // slider.onchange = function() {
                //     sliderDiv.innerHTML = this.value;
                // }
                slider.onchange = function()
                {
                    output.innerHTML = parseFloat(this.value)/100;
                    threshold =  parseFloat(this.value)/100;


                     var cvs1 = document.getElementById("Canvas");
                     var ctx1=cvs1.getContext("2d");
                    var cvs2 = document.getElementById("Canvas2");
                     var ctx2=cvs2.getContext("2d");
                     ctx1.clearRect(0, 0, cvs1.width, cvs1.height);
                        ctx2.clearRect(0, 0, cvs2.width, cvs2.height);
                      for (var k = 0; k < ID_probaility_densenet.length; k++)
                      {
                             if (ID_probaility_densenet[k] > threshold)
                             {red_yellow_densenet[k] = 1}
                            else
                             {red_yellow_densenet[k] = 0}
                            
                            if (ID_probaility_resnet[k] > threshold)
                             {red_yellow_resnet[k] = 1}
                            else
                             {red_yellow_resnet[k] = 0}
                      }


                    for(var i = 0; i < contour.length; i++)
                    {
                           ctx1.beginPath();
                           ctx1.lineWidth = 1;

                           if (red_yellow_resnet[i]==1)
                              {ctx1.strokeStyle = "red";}
                           else
                           {ctx1.strokeStyle = "yellow";}

                           ctx1.moveTo(contour[i][0][0], contour[i][0][1]);
                           for(var j = 1; j < contour[i].length; j++)
                           {
                                 ctx1.lineTo(contour[i][j][0], contour[i][j][1]);
                           }
                           ctx1.lineTo(contour[i][0][0], contour[i][0][1]);
                           ctx1.stroke();
                           
                            ctx2.beginPath();
                           ctx2.lineWidth = 1;

                           if (red_yellow_densenet[i]==1)
                              {ctx2.strokeStyle = "red";}
                           else
                           {ctx2.strokeStyle = "yellow";}

                           ctx2.moveTo(contour[i][0][0], contour[i][0][1]);
                           for(var j = 1; j < contour[i].length; j++)
                           {
                                 ctx2.lineTo(contour[i][j][0], contour[i][j][1]);
                           }
                           ctx2.lineTo(contour[i][0][0], contour[i][0][1]);
                           ctx2.stroke();
                     }
                };








           $(".pagination li").on('click',function (e) {
              e.preventDefault();
                    if(currentpage<=3){
                        $("#page-"+currentpage+"").removeClass('active');
                    }
                    else{
                         $("#page-3").removeClass('active');
                    }
                    if($(this).text()=="Previous")
                    {
                         if(currentpage==1)
                         {
                             alert("Already first page")
                             return false
                         }
                         else
                             {
                             currentpage-=1
                         }
                    }
                    else if($(this).text()=="Next")
                    {
                        if(currentpage>1000)
                         {
                             alert("Out Of List")
                             return false
                         }
                         else
                             {
                             currentpage+=1
                         }
                    }
                    else
                    {
                        currentpage=parseInt($(this).text())

                    }
                    if(currentpage<=3)
                     {
                         document.getElementById("page-1").innerHTML="<a class=\"page-link\" href=\"#\">1"
                         document.getElementById("page-2").innerHTML="<a class=\"page-link\" href=\"#\">2"
                         document.getElementById("page-3").innerHTML="<a class=\"page-link\" href=\"#\">3"
                         document.getElementById("page-4").innerHTML="<a class=\"page-link\" href=\"#\">4"
                         document.getElementById("page-5").innerHTML="<a class=\"page-link\" href=\"#\">5"

                         $("#page-"+currentpage+"").addClass('active');
                     }
                     else
                     {
                         document.getElementById("page-1").innerHTML="<a class=\"page-link\" href=\"#\">"+(parseInt(currentpage)-2)+""
                         document.getElementById("page-2").innerHTML="<a class=\"page-link\" href=\"#\">"+(parseInt(currentpage)-1)+""
                         document.getElementById("page-3").innerHTML="<a class=\"page-link\" href=\"#\">"+parseInt(currentpage)+""
                         document.getElementById("page-4").innerHTML="<a class=\"page-link\" href=\"#\">"+(parseInt(currentpage)+1)+""
                         document.getElementById("page-5").innerHTML="<a class=\"page-link\" href=\"#\">"+(parseInt(currentpage)+2)+""
                         $("#page-3").addClass('active');
                     }

                     var data = {
                        data: JSON.stringify({
                            'currentpage': currentpage,
                            'threshold': threshold,
                        }),
                    }

           $.ajax({
                        type: "POST",
                        dataType: "json",
                        url: "/Classifier_Thresholding",//后端请求
                        data: data,
                          success: function (result) {
                                       filedirname=result.filedirname
                              document.getElementById("img1").src="./static/type/images_resized/"+filedirname+".png";
                 document.getElementById("img2").src="./static/type/images_resized/"+filedirname+".png";

                 contour = result.contour;
                 ID=result.ID;
                 red_yellow_resnet=result.red_yellow_resnet;
                 red_yellow_densenet=result.red_yellow_densenet;
                 ID_probaility_resnet = result.ID_probaility_resnet;
                 ID_probaility_densenet = result.ID_probaility_densenet;
                      var cvs1 = document.getElementById("Canvas");
                     var ctx1=cvs1.getContext("2d");
                    var cvs2 = document.getElementById("Canvas2");
                     var ctx2=cvs2.getContext("2d");
                     ctx1.clearRect(0, 0, cvs1.width, cvs1.height);
                        ctx2.clearRect(0, 0, cvs2.width, cvs2.height);
                for(var i = 0; i < contour.length; i++)
                {
                       ctx1.beginPath();
                       ctx1.lineWidth = 1;

                       if (red_yellow_resnet[i]==1)
                          {ctx1.strokeStyle = "red";}
                       else
                       {ctx1.strokeStyle = "yellow";}

                       ctx1.moveTo(contour[i][0][0], contour[i][0][1]);
                       for(var j = 1; j < contour[i].length; j++)
                       {
                             ctx1.lineTo(contour[i][j][0], contour[i][j][1]);
                       }
                       ctx1.lineTo(contour[i][0][0], contour[i][0][1]);
                       ctx1.stroke();

                        ctx2.beginPath();
                       ctx2.lineWidth = 1;

                       if (red_yellow_densenet[i]==1)
                          {ctx2.strokeStyle = "red";}
                       else
                       {ctx2.strokeStyle = "yellow";}

                       ctx2.moveTo(contour[i][0][0], contour[i][0][1]);
                       for(var j = 1; j < contour[i].length; j++)
                       {
                             ctx2.lineTo(contour[i][j][0], contour[i][j][1]);
                       }
                       ctx2.lineTo(contour[i][0][0], contour[i][0][1]);
                       ctx2.stroke();
                 }
             }
                    });
          });

           $.ajax({
             type: "GET",
             dataType: "json",
             url: "/Classifier_Thresholding",//后端请求
             data: "",
             success: function (result) {
                            filedirname=result.filedirname
                 document.getElementById("img1").src="./static/type/images_resized/"+filedirname+".png";
                 document.getElementById("img2").src="./static/type/images_resized/"+filedirname+".png";

                 contour = result.contour;
                 ID=result.ID;
                 red_yellow_resnet=result.red_yellow_resnet;
                 red_yellow_densenet=result.red_yellow_densenet;
                 ID_probaility_resnet = result.ID_probaility_resnet;
                 ID_probaility_densenet = result.ID_probaility_densenet;
                      var cvs1 = document.getElementById("Canvas");
                     var ctx1=cvs1.getContext("2d");
                    var cvs2 = document.getElementById("Canvas2");
                     var ctx2=cvs2.getContext("2d");
                     ctx1.clearRect(0, 0, cvs1.width, cvs1.height);
                        ctx2.clearRect(0, 0, cvs2.width, cvs2.height);
                for(var i = 0; i < contour.length; i++)
                {
                       ctx1.beginPath();
                       ctx1.lineWidth = 1;

                       if (red_yellow_resnet[i]==1)
                          {ctx1.strokeStyle = "red";}
                       else
                       {ctx1.strokeStyle = "yellow";}

                       ctx1.moveTo(contour[i][0][0], contour[i][0][1]);
                       for(var j = 1; j < contour[i].length; j++)
                       {
                             ctx1.lineTo(contour[i][j][0], contour[i][j][1]);
                       }
                       ctx1.lineTo(contour[i][0][0], contour[i][0][1]);
                       ctx1.stroke();

                        ctx2.beginPath();
                       ctx2.lineWidth = 1;

                       if (red_yellow_densenet[i]==1)
                          {ctx2.strokeStyle = "red";}
                       else
                       {ctx2.strokeStyle = "yellow";}

                       ctx2.moveTo(contour[i][0][0], contour[i][0][1]);
                       for(var j = 1; j < contour[i].length; j++)
                       {
                             ctx2.lineTo(contour[i][j][0], contour[i][j][1]);
                       }
                       ctx2.lineTo(contour[i][0][0], contour[i][0][1]);
                       ctx2.stroke();
                 }



                 //###########################################
                 currentpage = result.currentpage;
                 for(var i = 1; i < 6; i++)
                 {
                         $("#page-"+i+"").removeClass('active');
                 }

                    if(currentpage<=3)
                 {
                     document.getElementById("page-1").innerHTML="<a class=\"page-link\" href=\"#\">1"
                     document.getElementById("page-2").innerHTML="<a class=\"page-link\" href=\"#\">2"
                     document.getElementById("page-3").innerHTML="<a class=\"page-link\" href=\"#\">3"
                     document.getElementById("page-4").innerHTML="<a class=\"page-link\" href=\"#\">4"
                     document.getElementById("page-5").innerHTML="<a class=\"page-link\" href=\"#\">5"

                     $("#page-"+currentpage+"").addClass('active');
                 }
                 else
                 {
                     document.getElementById("page-1").innerHTML="<a class=\"page-link\" href=\"#\">"+(parseInt(currentpage)-2)+""
                     document.getElementById("page-2").innerHTML="<a class=\"page-link\" href=\"#\">"+(parseInt(currentpage)-1)+""
                     document.getElementById("page-3").innerHTML="<a class=\"page-link\" href=\"#\">"+parseInt(currentpage)+""
                     document.getElementById("page-4").innerHTML="<a class=\"page-link\" href=\"#\">"+(parseInt(currentpage)+1)+""
                     document.getElementById("page-5").innerHTML="<a class=\"page-link\" href=\"#\">"+(parseInt(currentpage)+2)+""
                     $("#page-3").addClass('active');
                 }
             }
         });



           })
 </script>
{% endblock %}
{% block body %}
    <div class="container-fluid">
    <div class="row h-15">
    <div class="col-12">
    <header>
  <!-- Fixed navbar -->
  <nav class="navbar navbar-expand-md navbar-dark fixed-top bg-dark">
    <a class="navbar-brand" href="#">Nav</a>
    <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarCollapse" aria-controls="navbarCollapse" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>
    <div class="collapse navbar-collapse" id="navbarCollapse">
      <ul class="navbar-nav mr-auto">
        <li class="nav-item active">
          <a class="nav-link" href="#">Home <span class="sr-only">(current)</span></a>
        </li>
        <li class="nav-item">
          <a class="nav-link" href="#">Link</a>
        </li>
        <li class="nav-item">
          <a class="nav-link disabled" href="#">Disabled</a>
        </li>
             <li class="nav-item dropdown">
        <a class="nav-link dropdown-toggle" href="#" id="dropdown01" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">Dropdown</a>
        <div class="dropdown-menu" aria-labelledby="dropdown01">
          <a class="dropdown-item" href="#">Action</a>
          <a class="dropdown-item" href="#">Another action</a>
          <a class="dropdown-item" href="#">Something else here</a>
        </div>
      </li>
      </ul>
      <form class="form-inline mt-2 mt-md-0">
        <input class="form-control mr-sm-2" type="text" placeholder="Search" aria-label="Search">
        <button class="btn btn-outline-success my-2 my-sm-0" type="submit">Search</button>
      </form>
    </div>
  </nav>
</header>
    </div>
    </div>
    </div>
    <div class="container-fluid">
    <div class="row m-0">
    <div class="col-6 ">
            <img id="img1" style="height: 800px;width: 800px;position: absolute;top: 70px;left: 30px " src="./static/type/images_resized/0-1000.png" />
            <canvas width="800" height="800"style="position: absolute;top: 70px;left: 30px;" id="Canvas"></canvas>
            <p style="font-size:50px;left: 100px;top:850px;position: absolute;">Resnet </p>
             <div style="left: 20px;top:750px;position: absolute;" id="Types">
                        <ul class="pagination pagination-lg" style="left: 100px;top:200px;position: absolute;">
                            <li class="page-item" id="page-Previous" ><a class="page-link" href="#">Previous</a></li>
                            <li class="page-item" id="page-1"><a class="page-link" href="#"></a></li>
                            <li class="page-item" id="page-2"><a class="page-link" href="#"></a></li>
                            <li class="page-item" id="page-3"><a class="page-link" href="#"></a></li>
                            <li class="page-item" id="page-4"><a class="page-link" href="#"></a></li>
                            <li class="page-item" id="page-5"><a class="page-link" href="#"></a></li>
                            <li class="page-item" id="page-Next"><a class="page-link" href="#">Next</a></li>
                        </ul>
                    </div>
                </div>
    <div class="col-6 ">
        <img id="img2" style="height: 800px;width: 800px;position: absolute;top: 70px;left: 30px " src="./static/type/images_resized/0-1000.png" />
        <canvas width="800" height="800"style="position: absolute;top: 70px;left: 30px;" id="Canvas2"></canvas>
      <p style="font-size:50px;left: 100px;top:850px;position: absolute;">Densenet </p>
        <div class="slidecontainer" style="left: 30px;top:930px;position: absolute;">
          <input type="range" min="0" max="100" value="50" class="slider" id="myRange" >
          <p style="font-size:50px;">Threshold: <span id="demo" style="font-size:50px;"></span></p>
        </div>
    </div>



    </div>
     </div>
{% endblock %}
